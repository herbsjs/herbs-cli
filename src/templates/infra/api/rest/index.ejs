const express = require('express')
const { endpoints, routes } = require('@herbsjs/herbs2rest')
const { herbarium } = require('@herbsjs/herbarium')
const controller = require('./controller')

async function rest(app, config) {

    const server = new express.Router()

    herbs2rest({ server, config })

    app.use(server)
}

async function herbs2rest({ server, config }) {

    // Herbs2REST will create Express endpoints
    // based on your use cases and entities.

    // 1. Create endpoints
    endpoints({ herbarium, controller }, {
        'v1': (endpoints) => {
            // endpoints.ignore('FindUser')

            // endpoints.for('SearchUser').use({
            //     method: 'GET',
            //     path: '/v1/search/',
            //     parameters: { query: { id: String } },
            // })

            endpoints.build()
        },
        // 'v2': (endpoints) => {
        //     endpoints.build()
        // }
    })

    // 2. Attach the endpoints to Express
    routes({ herbarium, server }).attach()

}

module.exports = { rest }