const express = require('express')
const { herbarium } = require('@herbsjs/herbarium')

const { sec } = require('./sec')
const { auth } = require('./auth')
<% if(props.graphql) {%>const { graphql } = require('./graphql')<% }%>
<% if(props.rest) {%>const { rest } = require('./rest')<% }%>
const { shelf } = require('./shelf')

async function start(config) {

  herbarium.requireAll()

  const app = express()
  await sec(app, config)
  await auth(app, config)
  <% if(props.rest) {%>await rest(app, config)<% }%>
  <% if(props.graphql) {%>await graphql(app, config)<% }%>
  await shelf(app, config)

  return app.listen(
    { port: config.api.port },
    // eslint-disable-next-line no-console
    () => console.log(`ðŸš€ Server ready! \n\nhttp://localhost:${config.api.port}/\n`))
}

module.exports = { start }
