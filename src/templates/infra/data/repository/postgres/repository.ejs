const { Repository } = require("@herbsjs/herbs2knex")
const { herbarium } = require('@herbsjs/herbarium')
const <%- props.name.pascalCase %> = require('../../../domain/entities/<%- props.name.camelCase %>')
const connection = require('../database/connection')

class <%- props.name.pascalCase %>Repository extends Repository {
    constructor(injection) {
        super({
            entity: <%- props.name.pascalCase %>,
            table: "<%- props.table %>",
            ids: [<% for (const [index, value] of Object.entries(props.primaryKeyFields)) { %><%if(index != 0) { %>, <% } %>'<%= value %>'<% } %>],
            knex: connection<%if(Object.values(props.foreignKeysFields).length) {%>,
            foreignKeys: [{ <% Object.entries(props.foreignKeysFields).forEach(([key, value], index) => {%><%if(index != 0) { %>, <% } %><%= key %>: <%= value %><% }) %> }]<% }%>
        })
    }
}

module.exports =
    herbarium.repositories
        .add(<%- props.name.pascalCase %>Repository, '<%- props.name.pascalCase %>Repository')
        .metadata({ entity: <%- props.name.pascalCase %> })
        .repository